#include <stdio.h>
#include <stdlib.h>
#include <pthread.h>
#include <errno.h>
#include <string.h>

#include <libxml/xmlmemory.h>
#include <libxml/parser.h>

unsigned char data_buf[]={0x00,0x86,0x48,0x83,0x70,0x8d,0x6b,0x08,0x34,0x04,0xea,0x90,0x41,0x78,0x1f,0xa8,0x94,0xd2,0x23,0x52,0xd4,0x5e,0x14, \
0x4b,0x00,0x11,0xa9,0x6a,0x2e,0x8a,0x25,0x03,0x08,0xd4,0xb5,0x17,0x85,0x13,0x04,0xc3,0x6a,0x56,0x8b,0xe2,0x89,0x8e,0xc1,0xb5,0x2b,0x45,0xf1, \
0x44,0xff,0x41,0x1a,0x96,0xa2,0xf0,0xa0,0x19,0xc8,0xad,0x49,0x0b,0x7c,0x50,0x00,0xc8,0x56,0xa4,0x85,0xbe,0x02,0xc0,0x40,0x20,0x03,0x9f,0x00, \
0x00,0x4a,0x00,0x01,0xc8,0x4a,0xd4,0x90,0xb3,0xc5,0x00,0x01,0x32,0x85,0x6a,0x48,0x55,0xe2,0x80,0x00,0x99,0xa2,0xb5,0x24,0x28,0xf0,0x00,0x00, \
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xc2,0x00,0x00,0x26,0xe3,0x20,0x9d,0x27,0xa7,0x08,0x9d,0x95,0x2d,0x67,0x9d,0x6c,0x4d,0x27,0xb2,0x29, \
0xdc,0x60,0x37,0x17,0x0e,0xd5,0x2c,0x2d,0x41,0x66,0x89,0xc5,0xe5,0x67,0x21,0x94,0x9e,0xfd,0x3c,0xc9,0x1e,0x28,0xac,0xd9,0xb9,0xa3,0x06,0x21, \
0xbb,0xa8,0x91,0xc1,0x4c,0x9a,0x21,0xac,0xcf,0x28,0xbf,0x2a,0x07,0x21,0x87,0x85,0x30,0x90,0x9f,0xf5,0xbd,0x46,0x0a,0x36,0x07,0xc2,0x34,0x33, \
0x4e,0x75,0x27,0x67,0xe5,0x89,0x51,0x88,0x96,0x9b,0x81,0x3b,0x55,0x3e,0x1b,0xba,0x71,0xca,0xa0,0x8a,0x22,0xc3,0xd3,0xe4,0x6b,0x63,0x30,0xf0, \
0x7e,0xb9,0xcb,0xc7,0x90,0x67,0xbb,0xff,0x02,0x35,0xcb,0x12,0x60,0xc0,0x8a,0x7c,0x2f,0x55,0x16,0xc4,0xc7,0x4e,0x3c,0xad,0x4f,0xb0,0x01,0x6c, \
0xc7,0xb8,0x12,0x01,0xb0,0x10,0xe6,0xfe,0x8c,0xa7,0xd7,0xe6,0xcb,0xaf,0x32,0xef,0x90,0x1f,0x83,0xfb,0x5e,0x66,0xf3,0xec,0x99,0x75,0x1e,0x8a, \
0x77,0x1f,0x1a,0xbb,0x2b,0x67,0x62,0x29,0x83,0xe3,0x1b,0x6b,0x2c,0xce,0xb8,0xe5,0xd7,0xd0,0x53,0x53,0xf2,0xdd,0x8b,0xe8,0x9b,0x9b,0x8c,0x2a, \
0xe4,0x4b,0xbc,0x4f,0x5a,0x22,0x73,0x6c,0x60,0x3c,0x40,0xe9,0xe0,0x34,0xf7,0x27,0xb8,0x6a,0x40,0x45,0xf3,0x9a,0xa9,0xd2,0x11,0x10,0x57,0x07, \
0x82,0x26,0xf5,0xbf,0xfe,0xbc,0x86,0xc2,0xf5,0x98,0x7d,0xe2,0x58,0xc8,0xe5,0x2d,0x7c,0x7e,0x5f,0x32,0x1c,0x64,0x52,0xe4,0x6b,0xc9,0x70,0x8e, \
0x40,0x6f,0xf0,0x97,0xd8,0x42,0x65,0xb2,0x38,0x3b,0x5a,0x6f,0xa6,0xae,0xba,0x3c,0x55,0x6a,0x60,0xbb,0x03,0x1b,0x6c,0x1a,0x3d,0x7e,0x7e,0xd3, \
0xbf,0x63,0x6f,0x21,0x22,0x34,0x4a,0x51,0x38,0x47,0x48,0x61,0x69,0xae,0xd5,0x4b,0x8e,0xdd,0x52,0xda,0x40,0x70,0xef,0xee,0x02,0x34,0xd0,0xaa, \
0x5d,0x71,0xae,0x3d,0xa3,0x12,0x90,0xa1,0x45,0x2e,0xa7,0x4a,0xbf,0x12,0x3a,0x4e,0x8c,0x0d,0xd1,0xcc,0xef,0xad,0x89,0xed,0xf4,0x6c,0x2d,0x5f, \
0xfd,0xc6,0x6f,0x38,0x8c,0x69,0x51,0x63,0x26,0x9a,0xab,0xbc,0x46,0xfa,0xb3,0x24,0x5d,0xa1,0x06,0xb0,0x9c,0xb4,0xfb,0x5d,0x3b,0x49,0xc0,0x73, \
0x7b,0x63,0xf6,0xf7,0xa3,0x31,0xfb,0xd3,0xda,0x5b,0xe3,0xbf,0xe1,0x30,0x27,0x08,0x5b,0x98,0x33,0x8a,0xd4,0x75,0x21,0x14,0x6a,0xd0,0x13,0xbc, \
0xb4,0xc0,0xca,0x48,0x96,0x8c,0xff,0xa5,0x4b,0xbe,0xb0,0x7a,0xb9,0x06,0x2b,0xeb,0x19,0xc6,0x6c,0x98,0xb6,0x64,0x12,0xf4,0x0c,0xdc,0xf9,0xf0, \
0x5e,0x30,0xd4,0x53,0xa2,0x8f,0xc6,0x73,0x40,0x93,0x51,0xa3,0xa1,0x0a,0x67,0xef,0xb5,0x51,0x6c,0xf2,0x62,0x9b,0x11,0xa1,0xb8,0x29,0xc9,0x56, \
0x2b,0xb1,0xa6,0xcb,0x4e,0x2e,0x84,0xd6,0x5e,0x55,0x1c,0x28,0x6e,0x60,0xec,0xc0,0xda,0xff,0x02,0xcf,0x57,0x16,0x6d,0x6d,0xfd,0xff,0xdc,0xf6, \
0x29,0xeb,0xeb,0x75,0x44,0xa8,0xed,0xff,0xd3,0x64,0x3b,0xe5,0xf4,0x5a,0x41,0xa9,0xd6,0x81,0x8f,0x22,0xb6,0x55,0x24,0x06,0xc8,0xc2,0x1f,0xcd, \
0x20,0xcd,0x85,0x3c,0x50,0x8c,0xc7,0x14,0xa2,0xdb,0x0c,0x9f,0x8a,0x84,0x27,0x50,0x34,0xfa,0x8d,0xf9,0x99,0xf2,0xf2,0x5e,0x26,0x0f,0xcb,0xff, \
0x07,0xa4,0x0b,0x8f,0x91,0x18,0xa3,0x5f,0x1e,0xb7,0xc1,0xbe,0x64,0x15,0x9c,0x05,0xb1,0x67,0xa9,0x85,0x5f,0xee,0x16,0xe5,0x2b,0x40,0x01,0x90, \
0xb4,0x21,0x57,0x65,0x94,0xbf,0x41,0x5d,0x4d,0xd8,0x19,0xb7,0xc6,0xb8,0x6f,0x0c,0xfd,0x10,0x42,0x09,0x3a,0xb8,0xca,0x68,0xe5,0xdd,0x63,0x15, \
0x65,0x99,0x83,0xa5,0x59,0xdc,0xb3,0x09,0x39,0xa5,0x10,0x14,0xf3,0x18,0x58,0x2f,0xd2,0xa9,0x75,0x37,0x30,0xc7,0x7e,0xd6,0x85,0xbd,0x40,0x69, \
0xf4,0x05,0xeb,0xdf,0xfd,0x9d,0x02,0x29,0x64,0x4d,0x62,0x9e,0x59,0x95,0xdf,0x10,0x98,0x83,0xf9,0xd9,0xde,0x71,0xf7,0x67,0xe3,0x8b,0xb8,0xcf, \
0xda,0xcd,0x35,0x53,0x02,0x9d,0x41,0x50,0x36,0x03,0x03};

char sibXmlFileName[64]="/home/share/test.xml";

int read_xml_sib1(xmlNodePtr node)
{
	printf("node->name %s\n",node->name);
	return 0;
}

int read_xml_sib2(xmlNodePtr node)
{
	printf("node->name %s\n",node->name);
	return 0;
}

int read_xml_sib3(xmlNodePtr node)
{
	printf("node->name %s\n",node->name);
	return 0;
}

int read_xml_sib4(xmlNodePtr node)
{
	printf("node->name %s\n",node->name);
	return 0;
}

int read_xml_sib5(xmlNodePtr node)
{
	printf("node->name %s\n",node->name);
	return 0;
}

int read_sib_xml_file(char *filename)
{
	xmlDocPtr doc = NULL;
	xmlNodePtr rootNode = NULL, node1 = NULL, node2 = NULL, node3 = NULL, node4 = NULL, node5 = NULL, node6 = NULL, node7 = NULL;
	
	doc = xmlReadFile(filename, NULL, XML_PARSE_RECOVER);
	if(doc == NULL)
    {
        printf("【Error】 Read XML File Error.\n");
        return -1;
    }
    rootNode = xmlDocGetRootElement(doc);
    if(xmlStrcmp(rootNode->name, BAD_CAST "BCCH-DL-SCH-Message"))
    {
        printf("【Error】 Document Of The Wrong Type, Root Node != BCCH-DL-SCH-Message.\n");
        xmlFreeDoc(doc);
        return -1;
    }
	printf("rootNode %s\n",rootNode->name);
//	printf("doc children %s\n",doc->children->children->name);
	node1 = rootNode->children;
//	printf("node1 %s\n",node1->name);
	
    while(node1 != NULL)
    {
//		printf("node1 %s\n",node1->name);
		if(!xmlStrcmp(node1->name, BAD_CAST "message"))
        {
            node2 = node1->children;
			while(node2 != NULL)
			{
				if(!xmlStrcmp(node2->name, BAD_CAST "c1"))
				{
					node3 = node2->children;
					while(node3 != NULL)
					{
						if(!xmlStrcmp(node3->name, BAD_CAST "systemInformation"))
						{
							node4 = node3->children;
							while(node4 != NULL)
							{
								if(!xmlStrcmp(node4->name, BAD_CAST "criticalExtensions"))
								{
									node5 = node4->children;
									while(node5 != NULL)
									{
										if(!xmlStrcmp(node5->name, BAD_CAST "systemInformation-r8"))
										{
											node6 = node5->children;
											while(node6 != NULL)
											{
												if(!xmlStrcmp(node6->name, BAD_CAST "sib-TypeAndInfo"))
												{
													node7 = node6->children;
													while(node7 != NULL)
													{
														if(!xmlStrcmp(node7->name, BAD_CAST "sib2"))
														{
															read_xml_sib2(node7);
														}
														if(!xmlStrcmp(node7->name, BAD_CAST "sib3"))
														{
															read_xml_sib3(node7);
															//printf("node7->name %s\n",node7->name);
														}
														if(!xmlStrcmp(node7->name, BAD_CAST "sib4"))
														{
															read_xml_sib4(node7);
														}
														if(!xmlStrcmp(node7->name, BAD_CAST "sib5"))
														{
															read_xml_sib5(node7);
														}
														node7 = node7->next;
													}
												}
												node6 = node6->next;
											}
										}
										node5 = node5->next;
									}
								}
								node4 = node4->next;
							}
						}
						if(!xmlStrcmp(node3->name, BAD_CAST "systemInformationBlockType1"))
						{
							read_xml_sib1(node3);
						}
						node3 = node3->next;
					}
				}
				node2 = node2->next;
			}
        }
        node1 = node1->next;
    }
	
	xmlFreeDoc(doc);
	return 0;
}

int main(int ac, char *av[])
{
	FILE *fd;
	
	fd=fopen("/home/share/output.per","w");
	fwrite(&data_buf,1500,1,fd);
	fclose(fd);
	system("sync");
	system("/home/share/asn1-e30-1/progname -p BCCH-DL-SCH-Message /home/share/output.per > /home/share/test.xml");
	system("sync");
	read_sib_xml_file(sibXmlFileName);
	printf("end.");

    return 0;
}
